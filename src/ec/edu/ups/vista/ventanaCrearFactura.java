/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package ec.edu.ups.vista;

import ec.edu.ups.controlador.ControladorCliente;
import ec.edu.ups.controlador.ControladorEmpleado;
import ec.edu.ups.controlador.ControladorFactura;
import ec.edu.ups.controlador.ControladorProducto;
import ec.edu.ups.modelo.Cliente;
import ec.edu.ups.modelo.Empleado;
import ec.edu.ups.modelo.Factura;
import ec.edu.ups.modelo.FacturaDetalle;
import ec.edu.ups.modelo.Producto;
import java.awt.event.KeyEvent;
import java.text.SimpleDateFormat;
import java.util.Date;
import java.util.Locale;
import java.util.ResourceBundle;
import java.util.Set;
import javax.swing.JOptionPane;
import javax.swing.table.DefaultTableModel;

/**
 *
 * @author Edison
 */
public class ventanaCrearFactura extends javax.swing.JInternalFrame {

    /**
     * Creates new form ventanaCrearFactura
     */
    private ControladorEmpleado controladorEmpleado;
    private ControladorCliente controladorCliente;
    private ControladorFactura controladorFactura;
    private ControladorProducto controladorProducto;
    private DefaultTableModel model;
    private double total1;
    private double total;
    private double subTotal;
    private double iva;
    private Producto producto;
    private Cliente cliente;
    private Empleado empleado;
    private FacturaDetalle facturaDetalle;
    private Date fecha;
    private SimpleDateFormat formato;
     private Locale localizacion;
    private ResourceBundle mensajes;

    public ventanaCrearFactura(ControladorEmpleado controladorEmpleado, ControladorCliente controladorCliente, ControladorFactura controladorFactura, ControladorProducto controladorProducto) {
        initComponents();
        this.controladorEmpleado = controladorEmpleado;
        this.controladorCliente = controladorCliente;
        this.controladorFactura = controladorFactura;
        this.controladorProducto = controladorProducto;
        fecha = new Date();
        formato = new SimpleDateFormat("dd/MM/yyyy");
        jLFecha.setText(formato.format(fecha));
        model = (DefaultTableModel) table.getModel();
        subTotal = 0;
        iva = 0;
        total = 0;
        txtCodigo.setText(String.valueOf(controladorFactura.getCodigo() + 1));
    }
    
    public void cambiarIdioma(ResourceBundle mensajes){
        
        //Jlabel
        lblCodigo.setText(mensajes.getString("cliente.codigo"));
        txtNombreE.setText(mensajes.getString("cliente.nombre"));
        lblNombreE.setText(mensajes.getString("cliente.nombre")); 
        lblCedula.setText(mensajes.getString("cliente.Cedula"));
        txtDireccion.setText(mensajes.getString("cliente.direccion"));
        txtTelefono.setText(mensajes.getString("cliente.telefono"));
        lblEmpeladoC.setText(mensajes.getString("empleado.cedula")); 
        lblSubTotal.setText(mensajes.getString("factura.subtotal"));
        lblIva.setText(mensajes.getString("factura.iva"));
        lblTotal.setText(mensajes.getString("factura.total"));
        
        //Botones
        btnGuardar.setText(mensajes.getString("btn.guardar"));
        btnCancelar.setText(mensajes.getString("btn.cancelar"));
        
        //table
        Object [] columnas = {mensajes.getString("cliente.codigo"), mensajes.getString("cliente.nombre"), mensajes.getString("factura.cantidad"), mensajes.getString("factura.descripcion"), mensajes.getString("producto.precio"), mensajes.getString("factura.total")};
        
        DefaultTableModel mod = (DefaultTableModel) table.getModel();
        mod.setColumnIdentifiers(columnas);
    }
    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        lblCodigo = new javax.swing.JLabel();
        jLabel1 = new javax.swing.JLabel();
        jLabel2 = new javax.swing.JLabel();
        jLabel3 = new javax.swing.JLabel();
        jLabel4 = new javax.swing.JLabel();
        jLEmpleado = new javax.swing.JLabel();
        lblEmpeladoC = new javax.swing.JLabel();
        txtIDE = new javax.swing.JTextField();
        lblNombreE = new javax.swing.JLabel();
        txtNombreE = new javax.swing.JTextField();
        jPanel4 = new javax.swing.JPanel();
        lblCedula1 = new javax.swing.JLabel();
        txtID = new javax.swing.JTextField();
        lblNombre1 = new javax.swing.JLabel();
        txtNombre = new javax.swing.JTextField();
        lblDireccion1 = new javax.swing.JLabel();
        txtDireccion = new javax.swing.JTextField();
        lblTelefono1 = new javax.swing.JLabel();
        txtTelefono = new javax.swing.JTextField();
        jScrollPane1 = new javax.swing.JScrollPane();
        table = new javax.swing.JTable();
        lblSubTotal = new javax.swing.JLabel();
        lblIva = new javax.swing.JLabel();
        lblTotal = new javax.swing.JLabel();
        btnGuardar = new javax.swing.JButton();
        btnCancelar = new javax.swing.JButton();
        txtTotal = new javax.swing.JTextField();
        txtIVA = new javax.swing.JTextField();
        txtSubTotal = new javax.swing.JTextField();
        txtCodigo = new javax.swing.JTextField();
        jLFecha = new javax.swing.JLabel();
        jLabel6 = new javax.swing.JLabel();

        getContentPane().setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        lblCodigo.setFont(new java.awt.Font("Arial", 1, 14)); // NOI18N
        lblCodigo.setForeground(new java.awt.Color(255, 255, 0));
        lblCodigo.setText("CÃ³digo");
        getContentPane().add(lblCodigo, new org.netbeans.lib.awtextra.AbsoluteConstraints(0, 20, 70, -1));

        jLabel1.setFont(new java.awt.Font("Arial", 1, 14)); // NOI18N
        jLabel1.setForeground(new java.awt.Color(255, 255, 0));
        jLabel1.setText("Nombre de la Empresa");
        getContentPane().add(jLabel1, new org.netbeans.lib.awtextra.AbsoluteConstraints(0, 60, 160, -1));

        jLabel2.setFont(new java.awt.Font("Arial", 1, 14)); // NOI18N
        jLabel2.setForeground(new java.awt.Color(255, 255, 0));
        jLabel2.setText("Direccion de la empresa");
        getContentPane().add(jLabel2, new org.netbeans.lib.awtextra.AbsoluteConstraints(0, 90, 180, -1));

        jLabel3.setFont(new java.awt.Font("Arial", 1, 14)); // NOI18N
        jLabel3.setForeground(new java.awt.Color(255, 255, 0));
        jLabel3.setText("Telefono de la empresa");
        getContentPane().add(jLabel3, new org.netbeans.lib.awtextra.AbsoluteConstraints(0, 110, 170, -1));

        jLabel4.setFont(new java.awt.Font("Arial", 1, 14)); // NOI18N
        jLabel4.setForeground(new java.awt.Color(255, 255, 0));
        jLabel4.setText("Ruc de la empresa");
        getContentPane().add(jLabel4, new org.netbeans.lib.awtextra.AbsoluteConstraints(0, 130, 140, -1));

        jLEmpleado.setFont(new java.awt.Font("Arial", 1, 14)); // NOI18N
        jLEmpleado.setForeground(new java.awt.Color(255, 255, 0));
        jLEmpleado.setText("Empleado:");
        getContentPane().add(jLEmpleado, new org.netbeans.lib.awtextra.AbsoluteConstraints(10, 160, 80, -1));

        lblEmpeladoC.setFont(new java.awt.Font("Arial", 1, 14)); // NOI18N
        lblEmpeladoC.setForeground(new java.awt.Color(255, 255, 0));
        lblEmpeladoC.setText("ID Empleado");
        getContentPane().add(lblEmpeladoC, new org.netbeans.lib.awtextra.AbsoluteConstraints(20, 190, 100, -1));

        txtIDE.setEditable(false);
        txtIDE.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txtIDEActionPerformed(evt);
            }
        });
        getContentPane().add(txtIDE, new org.netbeans.lib.awtextra.AbsoluteConstraints(140, 190, 90, -1));

        lblNombreE.setFont(new java.awt.Font("Arial", 1, 14)); // NOI18N
        lblNombreE.setForeground(new java.awt.Color(255, 255, 0));
        lblNombreE.setText("Nombre");
        getContentPane().add(lblNombreE, new org.netbeans.lib.awtextra.AbsoluteConstraints(250, 190, 60, -1));

        txtNombreE.setEditable(false);
        getContentPane().add(txtNombreE, new org.netbeans.lib.awtextra.AbsoluteConstraints(320, 190, 140, -1));

        jPanel4.setBorder(javax.swing.BorderFactory.createTitledBorder("Cliente"));

        lblCedula1.setText("ID");

        txtID.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txtIDActionPerformed(evt);
            }
        });

        lblNombre1.setText("Nombre");

        txtNombre.setEditable(false);
        txtNombre.setBackground(new java.awt.Color(255, 255, 255));

        lblDireccion1.setText("Direccion");

        txtDireccion.setEditable(false);
        txtDireccion.setBackground(new java.awt.Color(255, 255, 255));

        lblTelefono1.setText("Telefono");

        txtTelefono.setEditable(false);
        txtTelefono.setBackground(new java.awt.Color(255, 255, 255));

        javax.swing.GroupLayout jPanel4Layout = new javax.swing.GroupLayout(jPanel4);
        jPanel4.setLayout(jPanel4Layout);
        jPanel4Layout.setHorizontalGroup(
            jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel4Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel4Layout.createSequentialGroup()
                        .addComponent(lblCedula1)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(txtID, javax.swing.GroupLayout.PREFERRED_SIZE, 83, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(lblNombre1)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(txtNombre))
                    .addGroup(jPanel4Layout.createSequentialGroup()
                        .addComponent(lblDireccion1)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(txtDireccion, javax.swing.GroupLayout.PREFERRED_SIZE, 221, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(lblTelefono1)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(txtTelefono, javax.swing.GroupLayout.DEFAULT_SIZE, 124, Short.MAX_VALUE)))
                .addContainerGap())
        );
        jPanel4Layout.setVerticalGroup(
            jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel4Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lblCedula1)
                    .addComponent(txtID, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(lblNombre1)
                    .addComponent(txtNombre, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lblDireccion1)
                    .addComponent(txtDireccion, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(lblTelefono1)
                    .addComponent(txtTelefono, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        getContentPane().add(jPanel4, new org.netbeans.lib.awtextra.AbsoluteConstraints(0, 220, 480, -1));

        table.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "Codigo", "Cant.", "Descripcion", "Precio", "Total"
            }
        ) {
            boolean[] canEdit = new boolean [] {
                false, false, false, false, false
            };

            public boolean isCellEditable(int rowIndex, int columnIndex) {
                return canEdit [columnIndex];
            }
        });
        jScrollPane1.setViewportView(table);

        getContentPane().add(jScrollPane1, new org.netbeans.lib.awtextra.AbsoluteConstraints(0, 310, 480, 120));

        lblSubTotal.setFont(new java.awt.Font("Tahoma", 1, 14)); // NOI18N
        lblSubTotal.setForeground(new java.awt.Color(255, 255, 0));
        lblSubTotal.setText("Sub. Total");
        getContentPane().add(lblSubTotal, new org.netbeans.lib.awtextra.AbsoluteConstraints(260, 450, 80, 20));

        lblIva.setFont(new java.awt.Font("Tahoma", 1, 14)); // NOI18N
        lblIva.setForeground(new java.awt.Color(255, 255, 0));
        lblIva.setText("IVA");
        getContentPane().add(lblIva, new org.netbeans.lib.awtextra.AbsoluteConstraints(270, 480, 30, 20));

        lblTotal.setFont(new java.awt.Font("Tahoma", 1, 14)); // NOI18N
        lblTotal.setForeground(new java.awt.Color(255, 255, 0));
        lblTotal.setText("Total");
        getContentPane().add(lblTotal, new org.netbeans.lib.awtextra.AbsoluteConstraints(270, 510, 40, 20));

        btnGuardar.setText("Guardar");
        btnGuardar.setEnabled(false);
        btnGuardar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnGuardarActionPerformed(evt);
            }
        });
        getContentPane().add(btnGuardar, new org.netbeans.lib.awtextra.AbsoluteConstraints(90, 560, 120, -1));

        btnCancelar.setText("Cancelar");
        btnCancelar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnCancelarActionPerformed(evt);
            }
        });
        getContentPane().add(btnCancelar, new org.netbeans.lib.awtextra.AbsoluteConstraints(230, 560, 130, -1));

        txtTotal.setEditable(false);
        getContentPane().add(txtTotal, new org.netbeans.lib.awtextra.AbsoluteConstraints(350, 510, 120, -1));

        txtIVA.setEditable(false);
        txtIVA.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txtIVAActionPerformed(evt);
            }
        });
        getContentPane().add(txtIVA, new org.netbeans.lib.awtextra.AbsoluteConstraints(350, 480, 120, 20));

        txtSubTotal.setEditable(false);
        txtSubTotal.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txtSubTotalActionPerformed(evt);
            }
        });
        getContentPane().add(txtSubTotal, new org.netbeans.lib.awtextra.AbsoluteConstraints(350, 450, 120, 20));

        txtCodigo.setEditable(false);
        txtCodigo.setBackground(new java.awt.Color(255, 255, 255));
        txtCodigo.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txtCodigoActionPerformed(evt);
            }
        });
        getContentPane().add(txtCodigo, new org.netbeans.lib.awtextra.AbsoluteConstraints(80, 20, 70, -1));

        jLFecha.setFont(new java.awt.Font("Arial", 1, 14)); // NOI18N
        jLFecha.setForeground(new java.awt.Color(255, 255, 0));
        jLFecha.setText("23-02-2019");
        getContentPane().add(jLFecha, new org.netbeans.lib.awtextra.AbsoluteConstraints(310, 20, -1, -1));

        jLabel6.setIcon(new javax.swing.ImageIcon(getClass().getResource("/ec/edu/ups/Imagenes/taller2.jpg"))); // NOI18N
        getContentPane().add(jLabel6, new org.netbeans.lib.awtextra.AbsoluteConstraints(0, -30, 480, 680));

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void btnCancelarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnCancelarActionPerformed
        this.dispose();
    }//GEN-LAST:event_btnCancelarActionPerformed

    private void btnGuardarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnGuardarActionPerformed
        Factura factura = new Factura();
        factura.setCliente(cliente);
        factura.setEmpleado(empleado);
        factura.setSubTotal(subTotal);
        factura.setIva(iva);
        factura.setTotal(total);
        factura.setFecha(fecha);
        
        for(int i=0; i<table.getRowCount() -1; i++){
            facturaDetalle =new FacturaDetalle();
            facturaDetalle.setCodigo(Integer.parseInt(table.getValueAt(i, 0).toString()));
            
            int cant= Integer.parseInt(table.getValueAt(i, 1).toString());
            int c = cant;
            
            Producto producto = controladorProducto.read(Integer.parseInt(table.getValueAt(i, 0).toString()));
            producto.setStock(producto.getStock()-c);
            
            controladorProducto.update(producto);
            
            facturaDetalle.setCantidad(c);
            facturaDetalle.setProducto(controladorProducto.read(Integer.parseInt(table.getValueAt(i, 0).toString())));
            facturaDetalle.setPrecio(Double.parseDouble(table.getValueAt(i, 3).toString()));
            facturaDetalle.setSubtotal(Double.parseDouble(table.getValueAt(i, 4).toString()));
            factura.addFacturaDetalle(facturaDetalle);
            
            
        }   
        

        factura.setEstado("Activado");
        btnGuardar.setEnabled(false);
        JOptionPane.showMessageDialog(this, "Factura Creada", "Crear Factura", JOptionPane.OK_OPTION);
        txtID.setText("");
        txtIDE.setText("");
        txtNombreE.setText("");
        txtDireccion.setText("");
        txtIVA.setText("");
        txtNombre.setText("");
        txtSubTotal.setText("");
        txtTotal.setText("");
        txtTelefono.setText("");
        model.setColumnCount(5);
        model.setRowCount(0);
        Object[] datos2 = {"", 0, "", "", ""};
        model.addRow(datos2);
        subTotal = 0;
    }//GEN-LAST:event_btnGuardarActionPerformed

    private void txtIDActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txtIDActionPerformed
        if (txtID.getText() != null) {
            Set<Cliente> lista = controladorCliente.getLista();
            for (Cliente cliente : lista) {
                if (cliente.getCedula().equals(txtID.getText())) {
                    this.cliente = cliente;
                    txtNombre.setText(cliente.getNombre());
                    txtDireccion.setText(cliente.getDireccion());
                    txtTelefono.setText(cliente.getTelefono());
                }
            }
        }
    }//GEN-LAST:event_txtIDActionPerformed

    private void txtIDEActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txtIDEActionPerformed
        // TODO add your handling code here:
         if (!txtIDE.getText().equals(null)) {//es para ver si la caja de texto no esta vacia
            Set<Empleado> lista = controladorEmpleado.getLista();//crear una lista
            for (Empleado emplead : lista) {//recorre la lista creada
                if (emplead.getCedula().equals(txtIDE.getText())) {//busca la cedula del empleado en la lista
                    this.empleado = emplead;//se guarda
                    txtNombreE.setText(emplead.getNombre());//se envia el nombre a la caja de texto
                }
            }
        }
    }//GEN-LAST:event_txtIDEActionPerformed

    private void txtIVAActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txtIVAActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_txtIVAActionPerformed

    private void txtSubTotalActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txtSubTotalActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_txtSubTotalActionPerformed

    private void txtCodigoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txtCodigoActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_txtCodigoActionPerformed


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btnCancelar;
    private javax.swing.JButton btnGuardar;
    private javax.swing.JLabel jLEmpleado;
    private javax.swing.JLabel jLFecha;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel6;
    private javax.swing.JPanel jPanel4;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JLabel lblCedula1;
    private javax.swing.JLabel lblCodigo;
    private javax.swing.JLabel lblDireccion1;
    private javax.swing.JLabel lblEmpeladoC;
    private javax.swing.JLabel lblIva;
    private javax.swing.JLabel lblNombre1;
    private javax.swing.JLabel lblNombreE;
    private javax.swing.JLabel lblSubTotal;
    private javax.swing.JLabel lblTelefono1;
    private javax.swing.JLabel lblTotal;
    private javax.swing.JTable table;
    private javax.swing.JTextField txtCodigo;
    private javax.swing.JTextField txtDireccion;
    private javax.swing.JTextField txtID;
    private javax.swing.JTextField txtIDE;
    private javax.swing.JTextField txtIVA;
    private javax.swing.JTextField txtNombre;
    private javax.swing.JTextField txtNombreE;
    private javax.swing.JTextField txtSubTotal;
    private javax.swing.JTextField txtTelefono;
    private javax.swing.JTextField txtTotal;
    // End of variables declaration//GEN-END:variables
}
